---

Author: @linkavych
Date: 2022-08-26

--
# Covert Malware Launching

## Lab 12-1

Analyze the malware found in the file Lab12-01.exe and Lab12-01.dll. Make
sure that these files are in the same directory when performing the analysis.

1. What happens when you run the malware executable?

> A popup message box is created every miunute on the system.

2. What process is being injected?

> explorer.exe

3. How can you make the malware stop the pop-ups?

> Restart the 'explorer.exe' process.

4. How does this malware operate?

> The initial dropper will inject the DLL into the 'explorer.exe' process. Once injected, the DLLMain function will execute
> creating a popup window on the victim. This popup will repeat every 60 seconds.


## Lab 12-2

Analyze the malware found in the file Lab12-02.exe.

1. What is the purpose of this program?

> The initial loader will install the final keylogger payload on the target system. The keylogger will
> store data in the file `practicalmalwareanalysis.log`. 

2. How does the launcher program hide execution?

> The malware uses process replacement (process hollowing) to replace the execution of svchost.exe with code from the
> payload.

3. Where is the malicious payload stored?

> In the .rsrc section of the initial sample.

4. How is the malicious payload protected?

> The payload is stored in the initial sample's .rsrc section XOR encoded with a key of 0x41.

5. How are strings protected?

> XOR encoded

## Lab 12-3

Analyze the malware extracted during the analysis of Lab 12-2, or use the file
Lab12-03.exe.

1. What is the purpose of this malicious payload?

> This sample is a keylogger. It will store the captured data in the file `practicalmalwareanalysis.log`.

2. How does the malicious payload inject itself?

> The payload uses a hook to enable its abaility to log keystrokes from the target system.

3. What filesystem residue does this program create?

> `practicalmalwareanalysis.log`


## Lab 12-4

Analyze the malware found in the file Lab12-04.exe.

1. What does the code at 0x401000 accomplish?

> Compares a given process to see if it is `winlogon.exe`.

2. Which process has code injected?

> `winlogon.exe`

3. What DLL is loaded using LoadLibraryA?

> sfc_os.dll

4. What is the fourth argument passed to the CreateRemoteThread call?

> The starting address of the function to be called from sfc_os.dll. This is ordinal 2 of the sfc_os.dll, which is SfcTerminateWatcherThread. This 
> will disable Windows File protection.

5. What malware is dropped by the main executable?

> A downloader is dropped by the main executable, which overwrites the windows updater. The original windows updater is copied to the TEMP directory.

6. What is the purpose of this and the dropped malware?

> The malware will inject a remote thread into *winlogon.exe* and call the unnamed ordinal 2 function from *sfc_os.dll*. 
> This function, SfcTerminateWatcherThread, will disable Windows File protection until a reboot occurs. 
> After the file will copy the original windows updater program to the TEMP directory, and then overwrite the windows updater 
> program with a downloaded, malicious verison.
