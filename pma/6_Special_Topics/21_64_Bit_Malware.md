# 64-Bit Malware

## Lab 21-1

Analyze the code in Lab21-01.exe. This lab is similar to Lab 9-2, but tweaked
and compiled for a 64-bit system.

1. What happens when you run this program without any parameters?

> The sample terminates.

2. Depending on your version of IDA Pro, main may not be recognized
automatically. How can you identify the call to the main function?

> Generally, the main function will return a value back to the try point

3. What is being stored on the stack in the instructions from
0x0000000140001150 to 0x0000000140001161?

> `ocl.exe`

4. How can you get this program to run its payload without changing the
filename of the executable?

> Patch the jmp at 0x140001213

5. Which two strings are being compared by the call to strncmp at
0x0000000140001205?

> The strings being compared are jzm.exe and the name of the sample.

6. Does the function at 0x00000001400013C8 take any parameters?

> Yes, this function accepts the socket as it's only parameter.

7. How many arguments are passed to the call to CreateProcess at
0x0000000140001093? How do you know?

> This call takes 10 parameters. Ghidra shows this accurately, but CreateProcess takes
> 10 parameters according to MSDN documentation.


## Lab 21-2

Analyze the malware found in Lab21-02.exe on both x86 and x64 virtual
machines. This malware is similar to Lab12-01.exe, with an added x64
component.

1. What is interesting about the malwareâ€™s resource sections?

> The resources section contains three separate executable files named x86, x64, and x64DLL.

2. Is this malware compiled for x64 or x86?

> This was compiled for x86 architecture.

3. How does the malware determine the type of environment in which it is
running?

> The sample calls GetProcAddress with 'IsWow64Process', which sets a variable if successful. 

4. What does this malware do differently in an x64 environment versus an
x86 environment?

> On x86 systems, the sample will write the DLL to disk and inject into explorer.exe. On x64 systems, the sample will drpo two files to disk
> and launch the executable.

5. Which files does the malware drop when running on an x86 machine?
Where would you find the file or files?

> x86 - Lab21-2.dll @ c:\windows\system32\

6. Which files does the malware drop when running on an x64 machine?
Where would you find the file or files?

> Lab21-02x.dll and Lab21-02x.exe @ c:\windows\syswow64\

7. What type of process does the malware launch when run on an x64
system?

> Lab21-02x.exe

8. What does the malware do?

> On both systems, the sample performs DLL injection into explorer.exe.
