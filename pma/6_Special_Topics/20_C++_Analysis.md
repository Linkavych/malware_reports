# C++ Analysis

## Lab 20-1

The purpose of this first lab is to demonstrate the usage of the this pointer.
Analyze the malware in Lab20-01.exe.

1. Does the function at 0x401040 take any parameters?

> It does not take a parameter, but receives an object as a reference in ECX pointing to the `this` pointer.

2. Which URL is used in the call to URLDownloadToFile?

> `http://www[.]practicalmalwareanalysis.com/cpp.html`

3. What does this program do?

> Downloads a file and stores it at `c:\tempdownload.exe`.


## Lab 20-2
The purpose of this second lab is to demonstrate virtual functions. Analyze
the malware in Lab20-02.exe.

NOTE This program is not dangerous to your computer, but it will try to upload possibly sensi-
tive files from your machine.

1. What can you learn from the interesting strings in this program?

> The sample will interact with an FTP server at ftp.practicalmalwareanalysis.com. The sample
> will likely attempt to upload files to this server.

2. What do the imports tell you about this program?

> This sample likely interacts with the target file system, and will upload relevant files to an FTP server.

3. What is the purpose of the object created at 0x4011D9? Does it have any
virtual functions?

> This object represents a `.doc` file. It has one virtual function at 0x401440 - this function
> will upload a file to the ftp server.

4. Which functions could possibly be called by the call [edx] instruction at
0x401349?

> This could call 0x401440, 0x401380, or 0x401370.

5. How could you easily set up the server that this malware expects in order
to fully analyze the malware without connecting it to the Internet?

> Setup an FTP server and redirect the DNS requests to point to that server address.

6. What is the purpose of this program?

> The sample will search fo .doc and .pdf files on the target and upload them to the server.

7. What is the purpose of implementing a virtual function call in this
program?

> This allows code to execute different upload functions for the different file types.

## Lab 20-3

This third lab is a longer and more realistic piece of malware. This lab comes
with a configuration file named config.dat that must be in the same directory
as the lab in order to execute properly. Analyze the malware in Lab20-03.exe.

1. What can you learn from the interesting strings in this program?

> The sample will interact with a website using both GET and POST requests. Several of the pages are listed in the strings 
> (srv.html, put.html, get.html, response.html, info.html, index.html). A config file is 
> potentially referenced with `config.dat`. Additionally, custom encoding may be used based on the 
> presence of two long strings of characters.

2. What do the imports tell you about this program?

> The sample imports ws2_32.dll, which enables functions to interact with other systems over the internet. In particular, it will be
> able to send and receive data.

3. At 0x4036F0, there is a function call that takes the string Config error,
followed a few instructions later by a call to CxxThrowException. Does the
function take any parameters other than the string? Does the function
return anything? What can you tell about this function from the context
in which itâ€™s used?

> This function does not take any parameters aside from the string, but ECX does contain the `this` pointer. This function initializes
> an exception object storing the string describing the exception.

4. What do the six entries in the switch table at 0x4025C8 do?

> These switch options represent options for commands within the backdoor. Do nothing, sleep, download, execute a program, upload, and recon the target.

5. What is the purpose of this program?

> This sample is a backdoor with multiple options for the attacker to use in connection with the target system. HTTP is the C2 channel.
