rule trickbot_mal {
   meta:
      description = "anchorDNS - file trickbot.mal.elf"
      author = "@linkavych"
      date = "2022-05-16"
      hash1 = "c721189a2b89cd279e9a033c93b8b5017dc165cba89eff5b8e1b5866195518bc"
   strings:
      $x1 = "Failed to parse fixed part of command payload. %s" fullword ascii 
      $x2 = "Failed to parse variable part of command payload. %s" fullword ascii 
      $x3 = "/tmp/anchor.log" fullword ascii 
      $x4 = “/etc/crontab” fullword ascii
      $s1 = "curity><requestedPrivileges><requestedExecutionLevel level=\"asInvoker\" uiAccess=\"false\"></requestedExecutionLevel></requeste" ascii 
      $s2 = "https://checkip.amazonaws.com" fullword ascii 
      $s3 = "http://checkip.amazonaws.com" fullword ascii 
      $s4 = "/C timeout 5 && %ssc.exe stop %S " fullword ascii 
      $s5 = "Failed to create read command" fullword ascii 
      $s6 = "No more connections allowed to host %s: %zu" fullword ascii 
      $s7 = "http://icanhazip.com" fullword ascii 
      $s8 = "https://wtfismyip.com/text" fullword ascii 
      $s9 = "https://icanhazip.com" fullword ascii 
      $s10 = "https://myexternalip.com/raw" fullword ascii 
      $s11 = "http://wtfismyip.com/text" fullword ascii
      $s12 = "/C timeout 10 && %ssc.exe delete %S" fullword ascii
      $s13 = "http://myexternalip.com/raw" fullword ascii
      $s14 = "RESOLVE %s:%d is - old addresses discarded!" fullword ascii 
   condition:
      uint16(0) == 0x457f and filesize < 2000KB and
      (
          ( 2 of ($x*) and all of ($s*)) or ( all of them )
      )
}