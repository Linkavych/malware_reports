---

author: @linkavych
date: 2022-10-02
link: https://www.malware-traffic-analysis.net/2021/10/22/index.html

---
# Incident Report - October 2021 - Three Emails

## Detailed Analysis

Due to the size of the packet capture, and to narrow analysis, I have split it into three parts based
on IP addresses found within the packet capture. I will address each section in turn, along with the associated email.

### Email 1 - 10.10.22.157 - Marcus Cobb - 2021-10-21-malicious-email-1102-UTC.eml

Marcus Cobb received an email with a 7z attachment on 21 October 2021. The email was allegedly from karen.marshall@olympus.co.uk.
The email's attachement was named `Order.7z` with a sha256 hash of `c7b83c5b3ab7114127fac61933145960b3b4e580eeab2f88eb31880fa447b910`. The archive
contains a single Windows executable file named `Order.exe` with a sha256 hash of `5bf04dc0a6c58392ab02344da78d8cf471f522f94a845974f33dac13a1e51af2`. This sample is a
.NET compiled binary. The sample returns as [NanoCore RAT](https://malpedia.caad.fkie.fraunhofer.de/details/win.nanocore) on [MalwareBazaar](https://bazaar.abuse.ch/sample/5bf04dc0a6c58392ab02344da78d8cf471f522f94a845974f33dac13a1e51af2/).

<img src="images/157_att.jpg" width=1000 align=center>

In the packet capture section for this host, at 14:34 UTC on 22 October 2021, the system begins issuing
DNS requests for a Dynamic DNS domain `kamuchehddhgfgf.ddns.net`, which resolves to IP `37.0.10[.]22`. The compromised computer then begins communication with this domain
using port `1187`.

<img src="images/157_nano.jpg" width=1000 align=center>

### Email 2 - 10.10.22.156 - Agnes Warren - 2021-10-21-malicious-email-1739-UTC.eml

The second email is sent to Agnes Warren and contains a ZIP archive attachment. The email is from info@bardsirishbar.net, and the attached ZIP archive contains an XLS file.
The sha256 hash for the ZIP archive is `705166d5a107122554448752482515ac0a4a6aeffcdd668625db55d9f84f2af4`. The XLS document is named `Document-1975072354.xls` and has
a sha256 hash of `e729cd74fbe0b2dba58a9bbd9eb973ff806a9f37b5d93266b3d2e86e46b86d8e`. The XLS document contains several macros that will download additional malware to
the now compromised system.

<img src="images/156_macro.jpg" width=1000 align=center>

In the macros, there are at least three (3) IP addresses `190.14.37[.]244`, `194.36.191[.]35`, and `178.23.190[.]8`. Hatching Triage shows
the configuration for the macros more clearly after execution:

<img src="images/156_xls_config.jpg" width=1000 align=center>

AT 14:37 UTC on 22 October 2021 the first of these downloads takes place to `190.14.37[.]244`, followed by `194.36.191[.]35`, and finally `178.23.190[.]8`. Respectively, they download
files named `44491.6090605324.dat`, but they are saved as `Celod.wac`, `Celod.wac1`, and `Celod.wac2`. The sha256 hash for these files is `95928b331e9942e4709b41ec8b59eb6f9e068f53ef2eeb15009feafd4ff5138d`.
This hash returns as belonging to the Qakbot malware family. The config for the sample has also been extracted by Hatching Triage:

<img src="images/156_qbot.jpg" width=1000 align=center>

Qakbot begins communicating with several C2 servers, before it moves on to spam operations from this host. An example C2 server TLS certificate is shown below:

<img src="images/156_c2cert.jpg" width=1000 align=center>

<img src="images/156_ops.jpg" width=1000 align=center>

All of the SPAMBOT traffic is encrypted with TLS as well, for the duration of the packet capture.

### Email 3 - 10.10.22.158 - Kevin Henderson - 2021-10-21-malicious-email-2214-UTC.eml

The third email is sent to Kevin henderson via a web form from a company web page. The email contains a link to a Google Document link.
The URL is `https://storage.googleapis.com/m4b38h10cm38.appspot.com/gdrive/folders/0/public/d/049fin4nvvfm4.html?id=12503510859242887`. The message references
a document kept at this address, but that is not found within the artifacts provided.

Moving to the packet capture, at UTC 14:36 on 22 October 2021, Kevin henerson's computer issues a GET request to
`sobolpand[.]top` at IP `172.67.139[.]101` to URI `/034g100/index.php`. As shown in the screenshot, this sets up a Windows execution path
and then downloads a binary to the system.

<img src="images/158_init.jpg" width=1000 align=center>

The binary is saved as `data.jpg` and has the sha256 hash of `11ced86019aa7f90c4caa35c902c907c04568a9f9842e3df0de0cebc9bf07cdc`. This sample is identified as BazarLoader
by both [VirusTotal](https://www.virustotal.com/gui/file/11ced86019aa7f90c4caa35c902c907c04568a9f9842e3df0de0cebc9bf07cdc) and [Malware Bazaar](https://bazaar.abuse.ch/sample/11ced86019aa7f90c4caa35c902c907c04568a9f9842e3df0de0cebc9bf07cdc/).
After the malware is downloaded we can see suspected C2 activity throughout the remainder of the PCAP:

<img src="images/158_c2.jpg" width=1000 align=center>

#### Local System Information

- 10.10.22.1
- Gateway Address

- 10.10.22.22
- Domain Controller
- ENEMYWATCH-DC
- enemywatch.net

- 10.10.22.156
- Hostname: DESKTOP-CFA3367
- MAC: 00:23:ae:fd:02:01
- User: Agnes Warren
- Username: agnes.warren

- 10.10.22.157
- Hostname: DESKTOP-NZ875R4
- MAC: 00:18:71:3b:18:69
- User: Marcus Cobb
- Username: marcus.cobb

- 10.10.22.158
- Hostname: DESKTOP-87WCE26
- MAC: 00:0e:35:30:b7:21
- User: Kevin Henderson
- Username: kevin.henderson

- 10.10.22.255
- Broadcast Address
