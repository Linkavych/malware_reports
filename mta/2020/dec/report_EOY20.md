---

author: @linkavych
date: 2022-09-19
link: https://isc.sans.edu/diary/End+of+Year+Traffic+Analysis+Quiz/26940

---
# Incident Report - End of Year Quiz

## Task

Given six (6) packet capture files, identify the malware associated with each capture.

## Capture 1

- Malware Type: *Ursnif*

This packet capture shows some of the common traits found in Ursnif malware compromises. The compromised machine, `10.12.19.101`, makes several
`GET` requests to a very long URI ending with a `.avi` extension. This was common for Ursnif infections at this time in 2020.

<img src="images/1_get.jpg" width=1000 align=center>

Additionally, the compromised computer downloads several RAR archives - which are likely additional stages of the malware or other payloads.

<img src="images/1_down.jpg" width=1000 align=center>

Finally, the C2 server for Ursnif at IP `45.141.84[.]247` encrypts its communication using a self-signed certificate. That certificate commonly
resembles the below image.

<img src="images/1_cert.jpg" width=1000 align=center>

## Capture 2

- Malware Type: *Trickbot*

This sample capture is a Trickbot compromise of the target system (10.12.19.104). There are several characteristics present which
provide evidence that this is Trickbot. First, the compromised system downloads and executable disguised as a PNG file
from `carhomeopathy[.]com` at URI `/diego.png`. The sha256 hash of this file is `da1ae69acf1b97bfac587addc9266155342bf8f2a7a80e0d09df9a577c39f7f9`, and matches
Trickbot samples uploaded to Malware Bazaar and other repositories.

<img src="images/2_trick.jpg" width=1000 align=center>

Additionally, the C2 traffic is encrypted with a self-signed certificate which fits the pattern for Trickbot.

<img src="images/2_cert.jpg" width=1000 align=center>


## Capture 3

- Malware Type: *Emotet*

This packet capture demonstrates an Emotet malware compromise of the target system. The initial `GET` request to the domain `haciaelsup[.]com` 
retrieves a DLL named `gCJ2XAG1mJSvIyCtEq273C.dll`. This DLL has a sha256 hash of `d343532969887773d1d8655259566f20da2dabc68381e2c40fb49a2d088bd66c`.
This hash shows as Emotet on both Virus Total and Intezer.

<img src="images/3_emotet.jpg" width=1000 align=center>


## Capture 4

- Malware Type: *Dridex*

All of the malware traffic within this packet capture is encrypted. Googling the primary domain `www.altavidatechnology[.]com` shows it was
associated with Dridex malware document downloads in the 2020s. Further, examining the encrypted C2 traffic, the TLS certificates
use random strings to fill out the required infromation and are self-signed. This is a common trait for Dridex, and the three (3)
certificates used in this communication are shown below.

<img src="images/4_dridex.jpg" width=1000 align=center>

<img src="images/4_cert1.jpg" width=1000 align=center>

<img src="images/4_cert2.jpg" width=1000 align=center>

<img src="images/4_cert3.jpg" width=1000 align=center>


## Capture 5

- Malware Type: *Hancitor with Ficker Stealer and Cobalt Strike*

This infection involved a user known as Gandal The Grey (gandalf.thegrey) on LAPTOP-J2R58U2Q at IP 10.12.17.101.
The infection chain begins with the user visiting Google Docs, which triggers the download of another document containing
malicious macros.

<img src="images/5_handown.jpg" width=1000 align=center>

Following the initial download, the document macros are triggered and download additional hancitor payloads to the target system. Additionally,
the malware issues a POST request to `peasseal[.]com` with some relevant system information, does two public IP checks, and then begins regular C2 communication with a server at 
`216.108.231[.]142:8080`.

<img src="images/5_ipchecks.jpg" width=1000 align=center>

Following this, C2 traffic continues with some additional POST requests exfiltrating data.

<img src="images/5_c2.jpg" width=1000 align=center>


## Capture 6

- Malware Type: *IcedID*

This chain startes with a `GET` request to `lleft5[.]com` at the URI `GET /images/rmt98ohbryn1ot5knatwwvhr1honp6tjd9wyyq0yjz1aqhgjdkvlblxjjoflrvvw9ucicnnf/xnded1?jse=strkjh&bjk=vxmamlqsoknobs&olwm=dmrdhmwb&bjru=jxvdf_gibcrvtso&es=mhzrfmfwgc HTTP/1.1\r\n`.
This returns a x86 DLL with the sha256 hash of `ab41487d0c5f2930eed11b53a6c19d43786f985093585ff7a3df0e9d01cdaa2f`, which is classed as IcedID by Virus Total.
The compromised system then begins to communicate with several domains ending in `.pw` and `.cyou`, a trait seen in other samples of IcedID malware.

<img src="images/6_iced.jpg" width=1000 align=center>

As with other malware samples, the traffic to these C2 domains is encrypted using a self-signed
certificate, with default settings, as shown below.

<img src="images/6_cert.jpg" width=1000 align=center>
